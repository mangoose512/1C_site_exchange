Функция ПолучитьПартнер(Объект,стр,сайт,ДатаЗАказов);

	//масс = Объект1.Пользователи.НайтиСтроки(новый Структура("ИДПользователя",стр.ИДПользователя));
	//
	//если масс.количество() = 0 тогда
		входящиеданные = стр;	
	//иначе 
	//	входящиеданные = масс[0];	
	//КонецЕсли;
	
	СсылкаНаОбъект = Справочники.Партнеры.ПустаяСсылка();
	тел_1 = "";
	Если СокрЛП(входящиеданные.Телефон) <> "" тогда
		тел_1 = входящиеданные.Телефон;
		Для ии = 1 по Стрдлина(входящиеданные.Телефон) цикл
			Если Найти("0123456789",Сред(входящиеданные.Телефон,ии,1)) > 0 тогда
				тел_1 = тел_1 + Сред(входящиеданные.Телефон,ии,1);
			конецесли;
		конеццикла;
		
		тел_1 = прав(тел_1,10); 
		
		ТекстЗапроса = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ПартнерыКонтактнаяИнформация.Ссылка КАК Партнер,
		|	ПартнерыКонтактнаяИнформация.НомерТелефона,
		|	ПартнерыКонтактнаяИнформация.Представление
		|ИЗ
		|	Справочник.Партнеры.КонтактнаяИнформация КАК ПартнерыКонтактнаяИнформация
		|ГДЕ
		|	ПартнерыКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(перечисление.ТипыКонтактнойИнформации.Телефон)
		|	и ПартнерыКонтактнаяИнформация.Ссылка.ДатаРегистрации >= НАЧАЛОПЕРИОДА(&ДатаРегистрации, ДЕНЬ)";
		Запрос = Новый Запрос;
		Запрос.Текст  = ТекстЗапроса;
		Запрос.УстановитьПараметр("ДатаРегистрации",ДатаЗаказов);
		
		выборка = Запрос.Выполнить().Выбрать();
		Пока выборка.Следующий() Цикл
			тел2 = "";
			Для ии = 1 по Стрдлина(выборка.Представление) цикл
				Если Найти("0123456789",Сред(выборка.Представление,ии,1)) > 0 тогда
					Тел2 = Тел2 + Сред(выборка.Представление,ии,1);
				конецесли;
			конеццикла;
			тел2 = прав(тел2,10);
			Если тел_1 = тел2 тогда
				СсылкаНаОбъект = выборка.Партнер;
				прервать;
			КонецЕсли;
		КонецЦикла;
	конецесли;
	
	
	Если СсылкаНаОбъект.пустая() тогда
		
		Партнер = Справочники.Партнеры.СоздатьЭлемент();
		Партнер.Наименование		= СокрЛП(СокрЛП(входящиеданные.ИмяПользователя));
		Партнер.НаименованиеПолное	= Партнер.Наименование;
		Партнер.ДатаРегистрации     = Дата(СтрЗаменить(СтрЗаменить(СтрЗаменить(СтрЗаменить(ВходящиеДанные.Дата,"-","")," ",""),":",""),"T",""));
		Партнер.Комментарий         = "#С_САЙТА";
		Партнер.Клиент              = Истина;
		Партнер.ЮрФизЛицо           = Перечисления.КомпанияЧастноеЛицо.ЧастноеЛицо;
		
		Если значениезаполнено(ВходящиеДанные.Адрес) тогда
			НовКИ = Партнер.КонтактнаяИнформация.Добавить();
			НовКИ.Вид = справочники.ВидыКонтактнойИнформации.АдресПартнера;
			НовКИ.Тип=  перечисления.ТипыКонтактнойИнформации.Адрес;
			НовКИ.Представление = СокрЛП(ВходящиеДанные.Адрес);  
		конецесли;
		
		//Если значениезаполнено(ВходящиеДанные.address_2) тогда
		//	НовКИ = Партнер.КонтактнаяИнформация.Добавить();
		//	НовКИ.Вид = справочники.ВидыКонтактнойИнформации.АдресПартнера;
		//	НовКИ.Тип=перечисления.ТипыКонтактнойИнформации.Адрес;
		//	НовКИ.Представление = ?(значениезаполнено(ВходящиеДанные.zip),СокрЛП(ВходящиеДанные.zip)+", ","")
		//	+ ?(значениезаполнено(ВходящиеДанные.city), СокрЛП(ВходящиеДанные.city) +", ","")
		//	+ СокрЛП(ВходящиеДанные.address_2);  
		//конецесли;
		
		Если значениезаполнено(ВходящиеДанные.Телефон)  тогда
			НовКИ = Партнер.КонтактнаяИнформация.Добавить();
			НовКИ.Вид = справочники.ВидыКонтактнойИнформации.ТелефонПартнера;
			НовКИ.Тип=перечисления.ТипыКонтактнойИнформации.Телефон;
			НовКИ.Представление = ВходящиеДанные.Телефон;      
		конецесли;
		
		//Если значениезаполнено(ВходящиеДанные.telephone1) тогда
		//	НовКИ = Партнер.КонтактнаяИнформация.Добавить();
		//	НовКИ.Вид = справочники.ВидыКонтактнойИнформации.ТелефонПартнера;
		//	НовКИ.Тип=перечисления.ТипыКонтактнойИнформации.Телефон;
		//	НовКИ.Представление = ВходящиеДанные.telephone1 ;       
		//конецесли;
		
		Если значениезаполнено(ВходящиеДанные.Емаил) тогда
			НовКИ = Партнер.КонтактнаяИнформация.Добавить();
			НовКИ.Вид = справочники.ВидыКонтактнойИнформации.EmailПартнера;
			НовКИ.Тип=перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты;
			НовКИ.Представление = СокрЛП(ВходящиеДанные.Емаил) ;
		конецесли;
		
		//Если значениезаполнено(ВходящиеДанные.email1) тогда
		//	НовКИ = Партнер.КонтактнаяИнформация.Добавить();
		//	НовКИ.Вид = справочники.ВидыКонтактнойИнформации.EmailПартнера;
		//	НовКИ.Тип=перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты;
		//	НовКИ.Представление = СокрЛП(ВходящиеДанные.email1) ;
		//конецесли;
		
		партнер.Записать();
		
		СсылкаНаОбъект = Партнер.Ссылка;
	КонецЕсли;
	
	Возврат  СсылкаНаОбъект;

	
	
КонецФункции
